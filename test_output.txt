============================= test session starts ==============================
platform linux -- Python 3.13.9, pytest-9.0.2, pluggy-1.6.0 -- /home/mikeb/work/nano/.auto-claude/worktrees/tasks/011-add-test-coverage-for-system-2-reasoning-component/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/mikeb/work/nano/.auto-claude/worktrees/tasks/011-add-test-coverage-for-system-2-reasoning-component
configfile: pyproject.toml
plugins: cov-7.0.0
collecting ... collected 287 items

neuromanifold_gpt/tests/test_block.py::test_block_forward_shape FAILED   [  0%]
neuromanifold_gpt/tests/test_block.py::test_block_gradient_flow FAILED   [  0%]
neuromanifold_gpt/tests/test_block_integration.py::test_full_block_integration FAILED [  1%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANLinear::test_initialization PASSED [  1%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANLinear::test_forward_shape PASSED [  1%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANLinear::test_backward_pass PASSED [  2%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANLinear::test_numerical_stability PASSED [  2%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANLinear::test_normalization_range PASSED [  2%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANLinear::test_different_degrees[3] PASSED [  3%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANLinear::test_different_degrees[4] PASSED [  3%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANLinear::test_different_degrees[5] PASSED [  3%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANLinear::test_no_bias PASSED [  4%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANFFN::test_forward_shape PASSED [  4%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANFFN::test_backward_pass PASSED [  4%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANFFN::test_dropout_behavior PASSED [  5%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANFFN::test_residual_compatibility PASSED [  5%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANFFN::test_numerical_stability PASSED [  5%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestCausalityPreservation::test_no_future_leakage PASSED [  6%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestCausalityPreservation::test_position_independence PASSED [  6%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyshevPolynomialProperties::test_polynomial_computation PASSED [  6%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyshevPolynomialProperties::test_orthogonality_hint PASSED [  7%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANCUDA::test_cuda_forward SKIPPED [  7%]
neuromanifold_gpt/tests/test_cheby_kan.py::TestChebyKANCUDA::test_cuda_backward SKIPPED [  8%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfig::test_config_defaults PASSED [  8%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfig::test_config_n_embd_divisible_by_heads PASSED [  8%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfig::test_config_valid_n_embd_and_heads PASSED [  9%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfig::test_config_sdr_n_active_computed PASSED [  9%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfig::test_config_model_architecture_defaults PASSED [  9%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfig::test_config_manifold_defaults PASSED [ 10%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfig::test_config_fhn_defaults PASSED [ 10%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfig::test_config_engram_defaults PASSED [ 10%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfig::test_config_dag_and_imagination_defaults PASSED [ 11%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfigNano::test_nano_preset_exists PASSED [ 11%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfigNano::test_nano_preset_values PASSED [ 11%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfigNano::test_nano_preset_reduced_manifold PASSED [ 12%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfigNano::test_nano_preset_sdr_n_active_computed PASSED [ 12%]
neuromanifold_gpt/tests/test_config.py::TestNeuroManifoldConfigNano::test_nano_preset_inherits_from_base PASSED [ 12%]
neuromanifold_gpt/tests/test_config.py::TestConfigValidation::test_sdr_sparsity_affects_n_active PASSED [ 13%]
neuromanifold_gpt/tests/test_config.py::TestConfigValidation::test_head_dim_computed_correctly PASSED [ 13%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderBasic::test_context_encoder_shape PASSED [ 13%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderBasic::test_context_encoder_local_attention PASSED [ 14%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderBasic::test_context_gate_bounded PASSED [ 14%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderBasic::test_context_encoder_deterministic PASSED [ 14%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderBasic::test_context_encoder_different_embed_dims PASSED [ 15%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderMask::test_local_mask_correctness PASSED [ 15%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderMask::test_mask_is_symmetric PASSED [ 16%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderMask::test_mask_caching FAILED [ 16%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderMask::test_mask_diagonal_always_false PASSED [ 16%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderGradients::test_context_encoder_gradient_flow PASSED [ 17%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderGradients::test_context_encoder_batch_independence PASSED [ 17%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderGradients::test_gradient_through_gate PASSED [ 17%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderConfig::test_from_config PASSED [ 18%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderConfig::test_from_nano_config PASSED [ 18%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderOptions::test_dropout_effect PASSED [ 18%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderOptions::test_no_layer_norm PASSED [ 19%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderOptions::test_with_layer_norm PASSED [ 19%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderOptions::test_extra_repr PASSED [ 19%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderValidation::test_invalid_n_heads PASSED [ 20%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderValidation::test_single_token_sequence PASSED [ 20%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderValidation::test_context_larger_than_sequence PASSED [ 20%]
neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderValidation::test_very_long_sequence PASSED [ 21%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_forward_shape PASSED [ 21%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_node_count_bounds PASSED [ 21%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_acyclic_structure PASSED [ 22%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_node_mask_consistency PASSED [ 22%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_adjacency_mask_application PASSED [ 22%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_deterministic_mode PASSED [ 23%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_complexity_positive PASSED [ 23%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_complexity_masking PASSED [ 24%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_surface_area_calculation PASSED [ 24%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_execution_order PASSED [ 24%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_execution_order_respects_dependencies PASSED [ 25%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_gradient_flow PASSED [ 25%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_batch_independence PASSED [ 25%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_empty_adjacency PASSED [ 26%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_training_vs_eval_mode PASSED [ 26%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_manifold_projection PASSED [ 26%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_different_sequence_lengths PASSED [ 27%]
neuromanifold_gpt/tests/test_dag_planner.py::test_dag_planner_device_movement PASSED [ 27%]
neuromanifold_gpt/tests/test_engram.py::test_engram_store_retrieve PASSED [ 27%]
neuromanifold_gpt/tests/test_engram.py::test_engram_capacity_limit PASSED [ 28%]
neuromanifold_gpt/tests/test_engram.py::test_engram_similarity_threshold PASSED [ 28%]
neuromanifold_gpt/tests/test_engram.py::test_engram_partial_overlap_retrieval PASSED [ 28%]
neuromanifold_gpt/tests/test_engram.py::test_engram_multiple_retrieval PASSED [ 29%]
neuromanifold_gpt/tests/test_engram.py::test_engram_clear PASSED         [ 29%]
neuromanifold_gpt/tests/test_engram.py::test_engram_empty_retrieval PASSED [ 29%]
neuromanifold_gpt/tests/test_engram.py::test_engram_device_movement PASSED [ 30%]
neuromanifold_gpt/tests/test_faster_kan.py::TestRSWAFBasis::test_output_shape PASSED [ 30%]
neuromanifold_gpt/tests/test_faster_kan.py::TestRSWAFBasis::test_output_range PASSED [ 31%]
neuromanifold_gpt/tests/test_faster_kan.py::TestRSWAFBasis::test_peak_at_center PASSED [ 31%]
neuromanifold_gpt/tests/test_faster_kan.py::TestRSWAFBasis::test_gradient_flow PASSED [ 31%]
neuromanifold_gpt/tests/test_faster_kan.py::TestRSWAFBasis::test_learnable_parameters PASSED [ 32%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANLayer::test_forward_shape PASSED [ 32%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANLayer::test_backward_pass PASSED [ 32%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANLayer::test_numerical_stability PASSED [ 33%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANLayer::test_no_base_weight PASSED [ 33%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANLayer::test_no_bias PASSED [ 33%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANLayer::test_different_centers[4] PASSED [ 34%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANLayer::test_different_centers[8] PASSED [ 34%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANLayer::test_different_centers[16] PASSED [ 34%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANFFN::test_forward_shape PASSED [ 35%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANFFN::test_backward_pass PASSED [ 35%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANFFN::test_dropout_behavior PASSED [ 35%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANFFN::test_residual_compatibility PASSED [ 36%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANFFN::test_numerical_stability PASSED [ 36%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANLinear::test_forward_shape PASSED [ 36%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANLinear::test_backward_pass PASSED [ 37%]
neuromanifold_gpt/tests/test_faster_kan.py::TestCausalityPreservation::test_position_independence PASSED [ 37%]
neuromanifold_gpt/tests/test_faster_kan.py::TestReplaceLinearWithFasterKAN::test_replace_linear PASSED [ 37%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANCUDA::test_cuda_forward SKIPPED [ 38%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANCUDA::test_cuda_backward SKIPPED [ 38%]
neuromanifold_gpt/tests/test_faster_kan.py::TestFasterKANCUDA::test_cuda_ffn SKIPPED [ 39%]
neuromanifold_gpt/tests/test_fhn.py::test_fhn_output_shape PASSED        [ 39%]
neuromanifold_gpt/tests/test_fhn.py::test_fhn_pulse_width_positive PASSED [ 39%]
neuromanifold_gpt/tests/test_fhn.py::test_fhn_threshold_behavior PASSED  [ 40%]
neuromanifold_gpt/tests/test_gpt.py::test_gpt_forward PASSED             [ 40%]
neuromanifold_gpt/tests/test_gpt.py::test_gpt_with_targets PASSED        [ 40%]
neuromanifold_gpt/tests/test_gpt.py::test_gpt_generate PASSED            [ 41%]
neuromanifold_gpt/tests/test_gpt.py::test_gpt_info_dict PASSED           [ 41%]
neuromanifold_gpt/tests/test_gpt.py::test_gpt_memory_stores_during_training PASSED [ 41%]
neuromanifold_gpt/tests/test_gpt.py::test_gpt_no_memory_during_eval PASSED [ 42%]
neuromanifold_gpt/tests/test_gpt.py::test_gpt_memory_active_retrieval FAILED [ 42%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_store_retrieve_l1 PASSED [ 42%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_tier_stats PASSED [ 43%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_l1_to_l2_demotion PASSED [ 43%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_l2_to_l3_demotion PASSED [ 43%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_l2_to_l1_promotion PASSED [ 44%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_l3_to_l1_promotion PASSED [ 44%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_retrieval_across_tiers PASSED [ 44%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_similarity_threshold PASSED [ 45%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_clear PASSED [ 45%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_empty_retrieval PASSED [ 45%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_top_k_limit PASSED [ 46%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_capacity_enforcement PASSED [ 46%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_partial_overlap_retrieval PASSED [ 47%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_multiple_retrieval_sorted PASSED [ 47%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_device_movement PASSED [ 47%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_access_count_tracking PASSED [ 48%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_tier_override_threshold PASSED [ 48%]
neuromanifold_gpt/tests/test_hierarchical_memory.py::test_hierarchical_len_method PASSED [ 48%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_thinking_layer_forward_shape PASSED [ 49%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_thinking_layer_gradient_flow PASSED [ 49%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_thinking_layer_with_dropout PASSED [ 49%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_forward_shape PASSED [ 50%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_gradient_flow PASSED [ 50%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_thinking_probs_range PASSED [ 50%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_mode_selections_binary PASSED [ 51%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_with_e7_prior PASSED [ 51%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_without_e7_prior PASSED [ 51%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_e7_default_when_none PASSED [ 52%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_training_mode PASSED [ 52%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_eval_mode_threshold PASSED [ 52%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_custom_threshold PASSED [ 53%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_multiple_thinking_layers PASSED [ 53%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_batch_consistency PASSED [ 54%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_complexity_features PASSED [ 54%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_router_output_stability PASSED [ 54%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_fast_path_when_disabled PASSED [ 55%]
neuromanifold_gpt/tests/test_hybrid_reasoning.py::test_hybrid_reasoning_with_dropout PASSED [ 55%]
neuromanifold_gpt/tests/test_imagination.py::TestImaginationOutputShapes::test_imagination_output_shape_no_goal PASSED [ 55%]
neuromanifold_gpt/tests/test_imagination.py::TestImaginationOutputShapes::test_imagination_output_shape_with_goal PASSED [ 56%]
neuromanifold_gpt/tests/test_imagination.py::TestImaginationOutputShapes::test_imagination_various_n_alternatives PASSED [ 56%]
neuromanifold_gpt/tests/test_imagination.py::TestImaginationOutputShapes::test_imagination_single_token PASSED [ 56%]
neuromanifold_gpt/tests/test_imagination.py::TestImaginationOutputShapes::test_imagination_various_embed_dims PASSED [ 57%]
neuromanifold_gpt/tests/test_imagination.py::TestImaginationSteps::test_imagination_two_steps PASSED [ 57%]
neuromanifold_gpt/tests/test_imagination.py::TestImaginationSteps::test_imagination_four_steps PASSED [ 57%]
neuromanifold_gpt/tests/test_imagination.py::TestImaginationSteps::test_noise_schedule_properties PASSED [ 58%]
neuromanifold_gpt/tests/test_imagination.py::TestGoalConditioning::test_goal_conditioning_affects_output PASSED [ 58%]
neuromanifold_gpt/tests/test_imagination.py::TestGoalConditioning::test_goal_affects_scores PASSED [ 58%]
neuromanifold_gpt/tests/test_imagination.py::TestScoreProperties::test_scores_finite PASSED [ 59%]
neuromanifold_gpt/tests/test_imagination.py::TestScoreProperties::test_best_matches_highest_score PASSED [ 59%]
neuromanifold_gpt/tests/test_imagination.py::TestScoreProperties::test_scores_vary_across_alternatives PASSED [ 59%]
neuromanifold_gpt/tests/test_imagination.py::TestGradientFlow::test_gradient_through_alternatives PASSED [ 60%]
neuromanifold_gpt/tests/test_imagination.py::TestGradientFlow::test_gradient_through_scores PASSED [ 60%]
neuromanifold_gpt/tests/test_imagination.py::TestGradientFlow::test_gradient_through_best PASSED [ 60%]
neuromanifold_gpt/tests/test_imagination.py::TestGradientFlow::test_gradient_with_goal PASSED [ 61%]
neuromanifold_gpt/tests/test_imagination.py::TestDeterminism::test_eval_mode_deterministic_with_seed PASSED [ 61%]
neuromanifold_gpt/tests/test_imagination.py::TestDeterminism::test_different_seeds_produce_different_results PASSED [ 62%]
neuromanifold_gpt/tests/test_imagination.py::TestDropout::test_dropout_training_mode PASSED [ 62%]
neuromanifold_gpt/tests/test_imagination.py::TestDropout::test_dropout_eval_mode PASSED [ 62%]
neuromanifold_gpt/tests/test_imagination.py::TestBatchSizeVariations::test_single_batch PASSED [ 63%]
neuromanifold_gpt/tests/test_imagination.py::TestBatchSizeVariations::test_large_batch PASSED [ 63%]
neuromanifold_gpt/tests/test_imagination.py::TestInternalComponents::test_denoiser_output_shape PASSED [ 63%]
neuromanifold_gpt/tests/test_imagination.py::TestInternalComponents::test_goal_encoder_output_shape PASSED [ 64%]
neuromanifold_gpt/tests/test_imagination.py::TestInternalComponents::test_scorer_output_shape PASSED [ 64%]
neuromanifold_gpt/tests/test_manifold.py::TestManifoldProjectionShape::test_manifold_projection_shape PASSED [ 64%]
neuromanifold_gpt/tests/test_manifold.py::TestManifoldProjectionShape::test_manifold_projection_single_token PASSED [ 65%]
neuromanifold_gpt/tests/test_manifold.py::TestManifoldProjectionShape::test_manifold_projection_various_dims PASSED [ 65%]
neuromanifold_gpt/tests/test_manifold.py::TestMetricTensor::test_metric_positive_definite PASSED [ 65%]
neuromanifold_gpt/tests/test_manifold.py::TestMetricTensor::test_metric_positive_definite_various_inputs PASSED [ 66%]
neuromanifold_gpt/tests/test_manifold.py::TestMetricTensor::test_metric_symmetric PASSED [ 66%]
neuromanifold_gpt/tests/test_manifold.py::TestGeodesicDistance::test_geodesic_distance_symmetric PASSED [ 66%]
neuromanifold_gpt/tests/test_manifold.py::TestGeodesicDistance::test_geodesic_distance_zero_diagonal PASSED [ 67%]
neuromanifold_gpt/tests/test_manifold.py::TestGeodesicDistance::test_geodesic_distance_non_negative PASSED [ 67%]
neuromanifold_gpt/tests/test_manifold.py::TestGeodesicDistance::test_geodesic_distance_shape PASSED [ 67%]
neuromanifold_gpt/tests/test_manifold.py::TestGradientFlow::test_gradient_through_coords PASSED [ 68%]
neuromanifold_gpt/tests/test_manifold.py::TestGradientFlow::test_gradient_through_metric FAILED [ 68%]
neuromanifold_gpt/tests/test_manifold.py::TestGradientFlow::test_gradient_through_distance PASSED [ 68%]
neuromanifold_gpt/tests/test_manifold.py::TestDeterminism::test_eval_mode_deterministic PASSED [ 69%]
neuromanifold_gpt/tests/test_manifold.py::TestCustomHiddenDim::test_custom_hidden_dim PASSED [ 69%]
neuromanifold_gpt/tests/test_manifold.py::TestCustomHiddenDim::test_default_hidden_dim PASSED [ 70%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestHardTopK::test_hard_topk_sparsity PASSED [ 70%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestHardTopK::test_hard_topk_single_tensor PASSED [ 70%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestHardTopK::test_hard_topk_deterministic PASSED [ 71%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestOverlapCount::test_overlap_count PASSED [ 71%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestOverlapCount::test_overlap_count_no_overlap PASSED [ 71%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestOverlapCount::test_overlap_count_full_overlap PASSED [ 72%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestOverlapCount::test_overlap_count_batched PASSED [ 72%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestUnion::test_union PASSED    [ 72%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestUnion::test_union_clamping PASSED [ 73%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestUnion::test_union_empty PASSED [ 73%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestIntersection::test_intersection PASSED [ 73%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestIntersection::test_intersection_disjoint PASSED [ 74%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestSemanticSimilarity::test_semantic_similarity_identical PASSED [ 74%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestSemanticSimilarity::test_semantic_similarity_disjoint PASSED [ 74%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestSemanticSimilarity::test_semantic_similarity_half PASSED [ 75%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestSparsity::test_sparsity PASSED [ 75%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestSparsity::test_sparsity_target PASSED [ 75%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestSoftTopK::test_soft_topk_gradient_flow PASSED [ 76%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestSoftTopK::test_soft_topk_same_sparsity PASSED [ 76%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestDtypeSupport::test_hard_topk_dtype[dtype0] PASSED [ 77%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestDtypeSupport::test_hard_topk_dtype[dtype1] PASSED [ 77%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestDtypeSupport::test_overlap_count_dtype[dtype0] PASSED [ 77%]
neuromanifold_gpt/tests/test_sdr_ops.py::TestDtypeSupport::test_overlap_count_dtype[dtype1] PASSED [ 78%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderOutputShape::test_encoder_output_shape FAILED [ 78%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderOutputShape::test_encoder_single_token FAILED [ 78%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderOutputShape::test_encoder_batch_sizes FAILED [ 79%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderSparsity::test_encoder_sparsity FAILED [ 79%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderSparsity::test_encoder_binary_values FAILED [ 79%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderSparsity::test_training_mode_sparsity FAILED [ 80%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestSemanticSimilarity::test_semantic_similarity_self FAILED [ 80%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestSemanticSimilarity::test_semantic_similarity_different_tokens FAILED [ 80%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestPhraseEncoding::test_encode_phrase FAILED [ 81%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestPhraseEncoding::test_encode_phrase_batched FAILED [ 81%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestGradientFlow::test_gradient_through_encoder FAILED [ 81%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestGradientFlow::test_gradient_through_sdr FAILED [ 82%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestDeterminism::test_eval_mode_deterministic FAILED [ 82%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderComponents::test_context_encoder_integration FAILED [ 82%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderComponents::test_retina_integration PASSED [ 83%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestBoostingMechanism::test_boosting_updates_duty_cycle FAILED [ 83%]
neuromanifold_gpt/tests/test_semantic_folding.py::TestBoostingMechanism::test_boosting_disabled_in_eval FAILED [ 83%]
neuromanifold_gpt/tests/test_semantic_retina.py::TestSemanticRetina::test_retina_output_shape PASSED [ 84%]
neuromanifold_gpt/tests/test_semantic_retina.py::TestSemanticRetina::test_retina_smoothing PASSED [ 84%]
neuromanifold_gpt/tests/test_semantic_retina.py::TestSemanticRetina::test_gaussian_kernel_normalized PASSED [ 85%]
neuromanifold_gpt/tests/test_semantic_retina.py::TestSemanticRetina::test_retina_different_grid_sizes PASSED [ 85%]
neuromanifold_gpt/tests/test_semantic_retina.py::TestSemanticRetina::test_retina_kernel_size_affects_spread PASSED [ 85%]
neuromanifold_gpt/tests/test_semantic_retina.py::TestSemanticRetina::test_retina_batch_independence PASSED [ 86%]
neuromanifold_gpt/tests/test_semantic_retina.py::TestSemanticRetina::test_retina_gradient_flow PASSED [ 86%]
neuromanifold_gpt/tests/test_spectral.py::test_spectral_output_shapes PASSED [ 86%]
neuromanifold_gpt/tests/test_spectral.py::test_spectral_basis_normalized FAILED [ 87%]
neuromanifold_gpt/tests/test_spectral.py::test_spectral_frequencies_positive PASSED [ 87%]
neuromanifold_gpt/tests/test_spectral.py::test_ortho_regularization PASSED [ 87%]
neuromanifold_gpt/tests/test_spectral.py::test_spectral_gradient_flow PASSED [ 88%]
neuromanifold_gpt/tests/test_spectral.py::test_random_features_mode PASSED [ 88%]
neuromanifold_gpt/tests/test_spectral.py::TestFastSpectralAttention::test_output_shape PASSED [ 88%]
neuromanifold_gpt/tests/test_spectral.py::TestFastSpectralAttention::test_gradient_flow PASSED [ 89%]
neuromanifold_gpt/tests/test_spectral.py::TestFastSpectralAttention::test_numerical_stability PASSED [ 89%]
neuromanifold_gpt/tests/test_topographic_loss.py::test_topographic_loss_basic FAILED [ 89%]
neuromanifold_gpt/tests/test_topographic_loss.py::test_topographic_loss_gradient FAILED [ 90%]
neuromanifold_gpt/tests/test_topographic_loss.py::test_topographic_loss_inference FAILED [ 90%]
neuromanifold_gpt/tests/test_topographic_loss.py::test_full_model_integration PASSED [ 90%]
neuromanifold_gpt/tests/test_train.py::test_lightning_module_init PASSED [ 91%]
neuromanifold_gpt/tests/test_train.py::test_training_step PASSED         [ 91%]
neuromanifold_gpt/tests/test_train.py::test_configure_optimizers PASSED  [ 91%]
neuromanifold_gpt/tests/test_train.py::test_validation_step PASSED       [ 92%]
neuromanifold_gpt/tests/test_train.py::test_optimizer_has_weight_decay_groups PASSED [ 92%]
neuromanifold_gpt/tests/test_train.py::test_scheduler_is_cosine PASSED   [ 93%]
neuromanifold_gpt/tests/test_train.py::test_training_step_logs_metrics PASSED [ 93%]
neuromanifold_gpt/tests/test_train.py::test_config_has_training_params PASSED [ 93%]
neuromanifold_gpt/tests/test_train.py::TestCosineWarmupLR::test_lr_at_zero_is_small PASSED [ 94%]
neuromanifold_gpt/tests/test_train.py::TestCosineWarmupLR::test_lr_at_warmup_end PASSED [ 94%]
neuromanifold_gpt/tests/test_train.py::TestCosineWarmupLR::test_lr_after_decay PASSED [ 94%]
neuromanifold_gpt/tests/test_train.py::TestCosineWarmupLR::test_lr_monotonically_increases_during_warmup PASSED [ 95%]
neuromanifold_gpt/tests/test_train.py::TestGPTConfigureOptimizers::test_gpt_configure_optimizers PASSED [ 95%]
neuromanifold_gpt/tests/test_train.py::TestGPTConfigureOptimizers::test_gpt_optimizer_has_two_groups PASSED [ 95%]
neuromanifold_gpt/tests/test_train.py::TestGPTConfigureOptimizers::test_num_parameters FAILED [ 96%]
neuromanifold_gpt/tests/test_train.py::TestNanoGPTTrainingLoop::test_model_forward_returns_info_dict PASSED [ 96%]
neuromanifold_gpt/tests/test_train.py::TestNanoGPTTrainingLoop::test_model_gradient_flow PASSED [ 96%]
neuromanifold_gpt/tests/test_train.py::TestNanoGPTTrainingLoop::test_model_mixed_precision PASSED [ 97%]
neuromanifold_gpt/tests/test_train.py::TestNanoGPTTrainingLoop::test_gradient_accumulation_simulation PASSED [ 97%]
neuromanifold_gpt/tests/test_train.py::TestCheckpointing::test_checkpoint_roundtrip PASSED [ 97%]
neuromanifold_gpt/tests/test_wave_kan.py::TestWaveKAN::test_backward_pass PASSED [ 98%]
neuromanifold_gpt/tests/test_wave_kan.py::TestWaveKAN::test_causality PASSED [ 98%]
neuromanifold_gpt/tests/test_wave_kan.py::TestWaveKAN::test_numerical_stability PASSED [ 98%]
neuromanifold_gpt/tests/test_wave_kan.py::TestWaveKAN::test_wavekan_ffn_shapes PASSED [ 99%]
neuromanifold_gpt/tests/test_wave_kan.py::TestWaveKAN::test_wavekan_linear_shapes PASSED [ 99%]
neuromanifold_gpt/tests/test_wave_kan.py::TestWaveKAN::test_wavelet_types PASSED [100%]

=================================== FAILURES ===================================
___________________________ test_block_forward_shape ___________________________
.venv/lib/python3.13/site-packages/einops/einops.py:532: in reduce
    return _apply_recipe(
.venv/lib/python3.13/site-packages/einops/einops.py:235: in _apply_recipe
    init_shapes, axes_reordering, reduced_axes, added_axes, final_shapes, n_axes_w_added = _reconstruct_from_shape(
.venv/lib/python3.13/site-packages/einops/einops.py:188: in _reconstruct_from_shape_uncached
    raise EinopsError(f"Shape mismatch, can't divide axis of length {length} in chunks of {known_product}")
E   einops.EinopsError: Shape mismatch, can't divide axis of length 2 in chunks of 4

During handling of the above exception, another exception occurred:
neuromanifold_gpt/tests/test_block.py:16: in test_block_forward_shape
    out, info = block(sdr)
                ^^^^^^^^^^
.venv/lib/python3.13/site-packages/torch/nn/modules/module.py:1775: in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/torch/nn/modules/module.py:1786: in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
neuromanifold_gpt/model/block.py:259: in forward
    branch_input, add_residual_fn = self.mhc_attn(x)
                                    ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/torch/nn/modules/module.py:1775: in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/torch/nn/modules/module.py:1786: in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
neuromanifold_gpt/model/mhc.py:271: in forward
    branch_input, residuals_out, beta = self.width_connection(residuals)
                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
neuromanifold_gpt/model/mhc.py:183: in width_connection
    residuals = rearrange(residuals, "(b s) t d -> b t s d", s=streams)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/einops/einops.py:600: in rearrange
    return reduce(tensor, pattern, reduction="rearrange", **axes_lengths)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/einops/einops.py:542: in reduce
    raise EinopsError(message + "\n {}".format(e))
E   einops.EinopsError:  Error while processing rearrange-reduction pattern "(b s) t d -> b t s d".
E    Input tensor shape: torch.Size([2, 20, 384]). Additional info: {'s': 4}.
E    Shape mismatch, can't divide axis of length 2 in chunks of 4
___________________________ test_block_gradient_flow ___________________________
.venv/lib/python3.13/site-packages/einops/einops.py:532: in reduce
    return _apply_recipe(
.venv/lib/python3.13/site-packages/einops/einops.py:235: in _apply_recipe
    init_shapes, axes_reordering, reduced_axes, added_axes, final_shapes, n_axes_w_added = _reconstruct_from_shape(
.venv/lib/python3.13/site-packages/einops/einops.py:188: in _reconstruct_from_shape_uncached
    raise EinopsError(f"Shape mismatch, can't divide axis of length {length} in chunks of {known_product}")
E   einops.EinopsError: Shape mismatch, can't divide axis of length 2 in chunks of 4

During handling of the above exception, another exception occurred:
neuromanifold_gpt/tests/test_block.py:31: in test_block_gradient_flow
    out, _ = block(sdr)
             ^^^^^^^^^^
.venv/lib/python3.13/site-packages/torch/nn/modules/module.py:1775: in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/torch/nn/modules/module.py:1786: in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
neuromanifold_gpt/model/block.py:259: in forward
    branch_input, add_residual_fn = self.mhc_attn(x)
                                    ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/torch/nn/modules/module.py:1775: in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/torch/nn/modules/module.py:1786: in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
neuromanifold_gpt/model/mhc.py:271: in forward
    branch_input, residuals_out, beta = self.width_connection(residuals)
                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
neuromanifold_gpt/model/mhc.py:183: in width_connection
    residuals = rearrange(residuals, "(b s) t d -> b t s d", s=streams)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/einops/einops.py:600: in rearrange
    return reduce(tensor, pattern, reduction="rearrange", **axes_lengths)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/einops/einops.py:542: in reduce
    raise EinopsError(message + "\n {}".format(e))
E   einops.EinopsError:  Error while processing rearrange-reduction pattern "(b s) t d -> b t s d".
E    Input tensor shape: torch.Size([2, 20, 384]). Additional info: {'s': 4}.
E    Shape mismatch, can't divide axis of length 2 in chunks of 4
_________________________ test_full_block_integration __________________________
.venv/lib/python3.13/site-packages/einops/einops.py:532: in reduce
    return _apply_recipe(
.venv/lib/python3.13/site-packages/einops/einops.py:235: in _apply_recipe
    init_shapes, axes_reordering, reduced_axes, added_axes, final_shapes, n_axes_w_added = _reconstruct_from_shape(
.venv/lib/python3.13/site-packages/einops/einops.py:188: in _reconstruct_from_shape_uncached
    raise EinopsError(f"Shape mismatch, can't divide axis of length {length} in chunks of {known_product}")
E   einops.EinopsError: Shape mismatch, can't divide axis of length 2 in chunks of 4

During handling of the above exception, another exception occurred:
neuromanifold_gpt/tests/test_block_integration.py:42: in test_full_block_integration
    output, info = block(sdr)
                   ^^^^^^^^^^
.venv/lib/python3.13/site-packages/torch/nn/modules/module.py:1775: in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/torch/nn/modules/module.py:1786: in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
neuromanifold_gpt/model/block.py:259: in forward
    branch_input, add_residual_fn = self.mhc_attn(x)
                                    ^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/torch/nn/modules/module.py:1775: in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/torch/nn/modules/module.py:1786: in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
neuromanifold_gpt/model/mhc.py:271: in forward
    branch_input, residuals_out, beta = self.width_connection(residuals)
                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
neuromanifold_gpt/model/mhc.py:183: in width_connection
    residuals = rearrange(residuals, "(b s) t d -> b t s d", s=streams)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/einops/einops.py:600: in rearrange
    return reduce(tensor, pattern, reduction="rearrange", **axes_lengths)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.13/site-packages/einops/einops.py:542: in reduce
    raise EinopsError(message + "\n {}".format(e))
E   einops.EinopsError:  Error while processing rearrange-reduction pattern "(b s) t d -> b t s d".
E    Input tensor shape: torch.Size([2, 64, 128]). Additional info: {'s': 4}.
E    Shape mismatch, can't divide axis of length 2 in chunks of 4
----------------------------- Captured stdout call -----------------------------
Initializing NeuroManifoldBlock with WaveKAN...
Forward pass with input shape torch.Size([2, 64, 1024])...
___________________ TestContextEncoderMask.test_mask_caching ___________________
neuromanifold_gpt/tests/test_context_encoder.py:110: in test_mask_caching
    assert encoder._cached_seq_len == 5
E   assert 0 == 5
E    +  where 0 = ContextEncoder(\n  embed_dim=64, context_size=2, n_heads=4, dropout=0.0, use_layer_norm=True\n  (ln): LayerNorm((64,), eps=1e-05, elementwise_affine=True)\n  (context_proj): Linear(in_features=64, out_features=64, bias=True)\n  (context_attn): MultiheadAttention(\n    (out_proj): NonDynamicallyQuantizableLinear(in_features=64, out_features=64, bias=True)\n  )\n  (context_gate): Sequential(\n    (0): Linear(in_features=128, out_features=64, bias=True)\n    (1): Identity()\n    (2): Sigmoid()\n  )\n)._cached_seq_len
_______________________ test_gpt_memory_active_retrieval _______________________
neuromanifold_gpt/tests/test_gpt.py:123: in test_gpt_memory_active_retrieval
    assert retrieved > 0, f"Should retrieve memories from {memory_size} stored, got retrieved_count={retrieved}"
E   AssertionError: Should retrieve memories from 200 stored, got retrieved_count=0
E   assert 0 > 0
________________ TestGradientFlow.test_gradient_through_metric _________________
neuromanifold_gpt/tests/test_manifold.py:169: in test_gradient_through_metric
    assert sdr.grad.abs().sum() > 0
E   assert tensor(0.) > 0
E    +  where tensor(0.) = <built-in method sum of Tensor object at 0x7fa6262a9d10>()
E    +    where <built-in method sum of Tensor object at 0x7fa6262a9d10> = tensor([[[0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         ...,\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.]],\n\n        [[0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         ...,\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.]]]).sum
E    +      where tensor([[[0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         ...,\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.]],\n\n        [[0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         ...,\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.]]]) = <built-in method abs of Tensor object at 0x7fa6262aaa30>()
E    +        where <built-in method abs of Tensor object at 0x7fa6262aaa30> = tensor([[[0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         ...,\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.]],\n\n        [[0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         ...,\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.]]]).abs
E    +          where tensor([[[0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         ...,\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.]],\n\n        [[0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         ...,\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.],\n         [0., 0., 0.,  ..., 0., 0., 0.]]]) = tensor([[[ 1.1378, -1.6652,  0.4865,  ..., -0.7088, -1.0337, -0.0149],\n         [ 1.5764,  0.4866,  2.6238,  ...,  2.0424, -1.1987, -0.4237],\n         [-1.1881,  1.9141,  1.5131,  ..., -0.8262,  0.3243,  0.7430],\n         ...,\n         [ 0.9227, -0.4280,  0.8500,  ..., -1.0914,  0.3346, -0.8493],\n         [-0.6316,  3.3520, -0.6796,  ..., -0.6028, -2.7887,  0.5164],\n         [ 0.0690, -2.0537,  0.1260,  ...,  0.1077, -1.3140,  0.6401]],\n\n        [[-0.3521, -0.2631,  0.5068,  ..., -1.0483,  0.6156, -0.1346],\n         [ 0.6654, -0.3846,  0.6315,  ..., -0.8379, -0.4877, -1.0173],\n         [ 0.3883, -1.0391, -0.9060,  ..., -0.5278,  1.9486,  0.5055],\n         ...,\n         [-0.8443, -0.5221,  1.1783,  ...,  1.6787,  0.1177, -0.0381],\n         [ 0.3915, -0.6455,  1.1046,  ...,  0.8948,  0.1008, -0.6468],\n         [ 1.1683,  0.4871,  0.2954,  ...,  1.8761, -0.6021, -0.7651]]],\n       requires_grad=True).grad
_______________ TestEncoderOutputShape.test_encoder_output_shape _______________
neuromanifold_gpt/tests/test_semantic_folding.py:30: in test_encoder_output_shape
    sdr, scores = encoder(tokens)
    ^^^^^^^^^^^
E   ValueError: too many values to unpack (expected 2)
_______________ TestEncoderOutputShape.test_encoder_single_token _______________
neuromanifold_gpt/tests/test_semantic_folding.py:43: in test_encoder_single_token
    sdr, scores = encoder(tokens)
    ^^^^^^^^^^^
E   ValueError: too many values to unpack (expected 2)
_______________ TestEncoderOutputShape.test_encoder_batch_sizes ________________
neuromanifold_gpt/tests/test_semantic_folding.py:57: in test_encoder_batch_sizes
    sdr, _ = encoder(tokens)
    ^^^^^^
E   ValueError: too many values to unpack (expected 2)
__________________ TestEncoderSparsity.test_encoder_sparsity ___________________
neuromanifold_gpt/tests/test_semantic_folding.py:72: in test_encoder_sparsity
    sdr, _ = encoder(tokens)
    ^^^^^^
E   ValueError: too many values to unpack (expected 2)
________________ TestEncoderSparsity.test_encoder_binary_values ________________
neuromanifold_gpt/tests/test_semantic_folding.py:85: in test_encoder_binary_values
    sdr, _ = encoder(tokens)
    ^^^^^^
E   ValueError: too many values to unpack (expected 2)
_______________ TestEncoderSparsity.test_training_mode_sparsity ________________
neuromanifold_gpt/tests/test_semantic_folding.py:97: in test_training_mode_sparsity
    sdr, _ = encoder(tokens)
    ^^^^^^
E   ValueError: too many values to unpack (expected 2)
_____________ TestSemanticSimilarity.test_semantic_similarity_self _____________
neuromanifold_gpt/tests/test_semantic_folding.py:116: in test_semantic_similarity_self
    sdr, _ = encoder(tokens)
    ^^^^^^
E   ValueError: too many values to unpack (expected 2)
_______ TestSemanticSimilarity.test_semantic_similarity_different_tokens _______
neuromanifold_gpt/tests/test_semantic_folding.py:130: in test_semantic_similarity_different_tokens
    sdr, _ = encoder(tokens)
    ^^^^^^
E   ValueError: too many values to unpack (expected 2)
____________________ TestPhraseEncoding.test_encode_phrase _____________________
neuromanifold_gpt/tests/test_semantic_folding.py:149: in test_encode_phrase
    sdr, _ = encoder(tokens)
    ^^^^^^
E   ValueError: too many values to unpack (expected 2)
________________ TestPhraseEncoding.test_encode_phrase_batched _________________
neuromanifold_gpt/tests/test_semantic_folding.py:163: in test_encode_phrase_batched
    sdr, _ = encoder(tokens)
    ^^^^^^
E   ValueError: too many values to unpack (expected 2)
________________ TestGradientFlow.test_gradient_through_encoder ________________
neuromanifold_gpt/tests/test_semantic_folding.py:181: in test_gradient_through_encoder
    sdr, scores = encoder(tokens)
    ^^^^^^^^^^^
E   ValueError: too many values to unpack (expected 2)
__________________ TestGradientFlow.test_gradient_through_sdr __________________
neuromanifold_gpt/tests/test_semantic_folding.py:197: in test_gradient_through_sdr
    sdr, _ = encoder(tokens)
    ^^^^^^
E   ValueError: too many values to unpack (expected 2)
_________________ TestDeterminism.test_eval_mode_deterministic _________________
neuromanifold_gpt/tests/test_semantic_folding.py:216: in test_eval_mode_deterministic
    sdr1, _ = encoder(tokens)
    ^^^^^^^
E   ValueError: too many values to unpack (expected 2)
____________ TestEncoderComponents.test_context_encoder_integration ____________
neuromanifold_gpt/tests/test_semantic_folding.py:236: in test_context_encoder_integration
    sdr, _ = encoder(tokens)
    ^^^^^^
E   ValueError: too many values to unpack (expected 2)
____________ TestBoostingMechanism.test_boosting_updates_duty_cycle ____________
neuromanifold_gpt/tests/test_semantic_folding.py:268: in test_boosting_updates_duty_cycle
    sdr, _ = encoder(tokens)
    ^^^^^^
E   ValueError: too many values to unpack (expected 2)
_____________ TestBoostingMechanism.test_boosting_disabled_in_eval _____________
neuromanifold_gpt/tests/test_semantic_folding.py:283: in test_boosting_disabled_in_eval
    sdr, _ = encoder(tokens)
    ^^^^^^
E   ValueError: too many values to unpack (expected 2)
________________________ test_spectral_basis_normalized ________________________
neuromanifold_gpt/tests/test_spectral.py:29: in test_spectral_basis_normalized
    assert torch.allclose(row_sums, torch.ones(20), atol=1e-5)
E   assert False
E    +  where False = <built-in method allclose of type object at 0x7fa6b4d82740>(tensor([ 0.0269, -0.1704, -0.0552,  0.1889,  0.2286, -0.1747, -0.0668,  0.1990,\n         0.0999, -0.2024,  0.3295,  0.4300,  0.0409,  0.0967,  0.3319,  0.3495,\n         0.2065, -0.5126,  0.0492,  0.0097], grad_fn=<SumBackward1>), tensor([1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,\n        1., 1.]), atol=1e-05)
E    +    where <built-in method allclose of type object at 0x7fa6b4d82740> = torch.allclose
E    +    and   tensor([1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,\n        1., 1.]) = <built-in method ones of type object at 0x7fa6b4d82740>(20)
E    +      where <built-in method ones of type object at 0x7fa6b4d82740> = torch.ones
_________________________ test_topographic_loss_basic __________________________
neuromanifold_gpt/tests/test_topographic_loss.py:22: in test_topographic_loss_basic
    sdr, scores, topo_loss = encoder(tokens)
    ^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: too many values to unpack (expected 3)
________________________ test_topographic_loss_gradient ________________________
neuromanifold_gpt/tests/test_topographic_loss.py:51: in test_topographic_loss_gradient
    sdr, scores, topo_loss = encoder(tokens)
    ^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: too many values to unpack (expected 3)
_______________________ test_topographic_loss_inference ________________________
neuromanifold_gpt/tests/test_topographic_loss.py:81: in test_topographic_loss_inference
    sdr, scores, topo_loss = encoder(tokens)
    ^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: too many values to unpack (expected 3)
________________ TestGPTConfigureOptimizers.test_num_parameters ________________
neuromanifold_gpt/tests/test_train.py:262: in test_num_parameters
    assert n_params_total > n_params_no_embed
E   assert 15510356 > 15510356
=============================== warnings summary ===============================
neuromanifold_gpt/tests/test_train.py::test_training_step
neuromanifold_gpt/tests/test_train.py::test_validation_step
  /home/mikeb/work/nano/.auto-claude/worktrees/tasks/011-add-test-coverage-for-system-2-reasoning-component/.venv/lib/python3.13/site-packages/lightning/pytorch/core/module.py:451: You are trying to `self.log()` but the `self.trainer` reference is not registered on the model yet. This is most likely because the model hasn't been passed to the `Trainer`

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED neuromanifold_gpt/tests/test_block.py::test_block_forward_shape - eino...
FAILED neuromanifold_gpt/tests/test_block.py::test_block_gradient_flow - eino...
FAILED neuromanifold_gpt/tests/test_block_integration.py::test_full_block_integration
FAILED neuromanifold_gpt/tests/test_context_encoder.py::TestContextEncoderMask::test_mask_caching
FAILED neuromanifold_gpt/tests/test_gpt.py::test_gpt_memory_active_retrieval
FAILED neuromanifold_gpt/tests/test_manifold.py::TestGradientFlow::test_gradient_through_metric
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderOutputShape::test_encoder_output_shape
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderOutputShape::test_encoder_single_token
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderOutputShape::test_encoder_batch_sizes
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderSparsity::test_encoder_sparsity
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderSparsity::test_encoder_binary_values
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderSparsity::test_training_mode_sparsity
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestSemanticSimilarity::test_semantic_similarity_self
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestSemanticSimilarity::test_semantic_similarity_different_tokens
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestPhraseEncoding::test_encode_phrase
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestPhraseEncoding::test_encode_phrase_batched
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestGradientFlow::test_gradient_through_encoder
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestGradientFlow::test_gradient_through_sdr
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestDeterminism::test_eval_mode_deterministic
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestEncoderComponents::test_context_encoder_integration
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestBoostingMechanism::test_boosting_updates_duty_cycle
FAILED neuromanifold_gpt/tests/test_semantic_folding.py::TestBoostingMechanism::test_boosting_disabled_in_eval
FAILED neuromanifold_gpt/tests/test_spectral.py::test_spectral_basis_normalized
FAILED neuromanifold_gpt/tests/test_topographic_loss.py::test_topographic_loss_basic
FAILED neuromanifold_gpt/tests/test_topographic_loss.py::test_topographic_loss_gradient
FAILED neuromanifold_gpt/tests/test_topographic_loss.py::test_topographic_loss_inference
FAILED neuromanifold_gpt/tests/test_train.py::TestGPTConfigureOptimizers::test_num_parameters
============ 27 failed, 255 passed, 5 skipped, 2 warnings in 33.63s ============
