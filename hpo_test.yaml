# Test HPO Configuration for Integration Testing
# Minimal configuration with 5 trials and 100 iterations per trial

# Simplified search space for testing
search_space:
  # Learning rate
  learning_rate:
    type: float
    low: 1.0e-4
    high: 5.0e-3
    log: true

  # Model architecture (simplified)
  n_layer:
    type: int
    low: 2
    high: 4

  n_head:
    type: int
    low: 4
    high: 6

  # n_embd must be divisible by n_head - using categorical with valid values
  n_embd:
    type: categorical
    choices: [128, 160, 192, 224, 256]

  # Batch size
  batch_size:
    type: categorical
    choices: [32, 64]

  # Dropout rate
  dropout:
    type: float
    low: 0.0
    high: 0.2
    log: false

  # Test boolean parameters
  use_sdr:
    type: categorical
    choices: [true, false]

  # Gradient clipping
  grad_clip:
    type: float
    low: 0.5
    high: 1.5
    log: false

# Fixed parameters for testing
fixed_params:
  # Dataset
  dataset: "shakespeare_char"
  block_size: 256
  num_workers: 2

  # Training limits (short for testing)
  max_iters: 100
  eval_interval: 25
  log_interval: 10
  eval_iters: 10

  # Early stopping
  early_stopping_patience: 5

  # Optimization
  warmup_iters: 20
  lr_decay_iters: 100
  min_lr: 1.0e-5
  gradient_accumulation_steps: 1
  weight_decay: 0.1

  # Hardware
  devices: 1
  precision: "bf16-mixed"
  compile_model: false

  # I/O
  save_checkpoints: false
  wandb_log: false

  # Fixed architecture choices
  bias: false
  vocab_size: 0

  # Disable advanced features for testing
  use_kan: false
  use_fhn_partitioning: false
  use_mhc: false
  use_full_mhc: false
  use_kaufmann_attention: false

  # Fixed NeuroManifold settings
  sdr_size: 2048
  manifold_dim: 64
  n_eigenvectors: 32

  # Sampling
  sample_interval: 500
  sample_max_tokens: 100
  sample_temperature: 1.0
  sample_top_k: 40

# Optuna study configuration
study:
  # Study name
  name: "neuromanifold-hpo-test"

  # Direction: minimize validation loss
  direction: "minimize"

  # Number of trials to run (5 for testing)
  n_trials: 5

  # Sampler
  sampler: "tpe"

# Pruning configuration (enabled for testing)
pruning:
  enabled: true
  algorithm: "median"
  n_startup_trials: 2
  n_warmup_steps: 15
  interval_steps: 5
